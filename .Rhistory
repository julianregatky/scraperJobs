library(xml2)
library(rvest)
library(dplyr)
limpiar_string <- function(string) { return(gsub("^\\s+|\\s+$","",string)) }
continuar <- TRUE
pagina <- 1
html <- read_html(paste0("https://www.zonajobs.com.ar/ofertas-de-empleo-argentina-pagina-",pagina,".html?recientes=true"))
listado <- html_nodes(html,'div.aviso-no-sponsor')
elementos <- html_nodes(listado,'div')
#titulos <- html_text(html_nodes(elementos,'h2.titulo-aviso'))
links <- html_attr(html_node(html_nodes(elementos,'div.wrapper'),'a'),'href')
i = 1
html <- read_html(paste0("https://www.zonajobs.com.ar",links[i]))
titulo <- limpiar_string(html_text(html_node(html,'h1.aviso_title')))
empresa <- limpiar_string(html_text(html_node(html,'span#empresa')))
specs <- html_nodes(html,'div.aviso_specs')
specs_attr <- limpiar_string(html_text(html_nodes(specs,'div.spec_attr')))
specs_def <- limpiar_string(html_text(html_nodes(specs,'div.spec_def')))
specs_attr
specs_attr <- gsub(":","",limpiar_string(html_text(html_nodes(specs,'div.spec_attr'))))
specs_attr
specs_def
library(mongolite)
conexionDB <- mongo(collection = "datos", db = "scraperJobs")
datos_specs <- data.frame(specs_def)
colnames(datos_specs) <- specs_attr
datos_specs
datos_specs <- as.data.frame(matrix(specs_def,nrow=1))
colnames(datos_specs) <- specs_attr
datos_specs
datos_specs <- datos_specs %>% recode(Publicado, "Hoy" = Sys.Date())
datos_specs$Publicado <- recode(Publicado, "Hoy" = Sys.Date())
datos_specs$Publicado <- recode(datos_specs$Publicado, "Hoy" = Sys.Date())
datos_specs
class(datos_specs$Publicado)
Sys.Date()-1
Sys.Date()
html <- read_html("https://www.zonajobs.com.ar/empleos/jefe-de-taller-electrico-gba-norte-jefe-de-mantenimiento-gba-sur-1869939.html?indiceAviso=20")
titulo <- limpiar_string(html_text(html_node(html,'h1.aviso_title')))
empresa <- limpiar_string(html_text(html_node(html,'span#empresa')))
specs <- html_nodes(html,'div.aviso_specs')
specs_attr <- gsub(":","",limpiar_string(html_text(html_nodes(specs,'div.spec_attr'))))
specs_def <- limpiar_string(html_text(html_nodes(specs,'div.spec_def')))
datos_specs <- as.data.frame(matrix(specs_def,nrow=1))
colnames(datos_specs) <- specs_attr
datos_specs
gsub("[Publicado hace |días]","",datos_specs$Publicado)
datos_specs$Publicado <- ifelse(datos_specs$Publicado == "Hoy",Sys.Date(),
Sys.Date()+1-as.numeric(gsub("[Publicado hace |días]","",datos_specs$Publicado)))
datos_specs
html <- read_html(paste0("https://www.zonajobs.com.ar/ofertas-de-empleo-argentina-pagina-",pagina,".html?recientes=true"))
listado <- html_nodes(html,'div.aviso-no-sponsor')
elementos <- html_nodes(listado,'div')
#titulos <- html_text(html_nodes(elementos,'h2.titulo-aviso'))
links <- html_attr(html_node(html_nodes(elementos,'div.wrapper'),'a'),'href')
for(i in 1:length(links))
{
html <- read_html(paste0("https://www.zonajobs.com.ar",links[i]))
titulo <- limpiar_string(html_text(html_node(html,'h1.aviso_title')))
empresa <- limpiar_string(html_text(html_node(html,'span#empresa')))
specs <- html_nodes(html,'div.aviso_specs')
specs_attr <- gsub(":","",limpiar_string(html_text(html_nodes(specs,'div.spec_attr'))))
specs_def <- limpiar_string(html_text(html_nodes(specs,'div.spec_def')))
datos_specs <- as.data.frame(matrix(specs_def,nrow=1))
colnames(datos_specs) <- specs_attr
datos_specs$Publicado <- ifelse(datos_specs$Publicado == "Hoy",Sys.Date(),
Sys.Date()+1-as.numeric(gsub("[Publicado hace |días]","",datos_specs$Publicado)))
datos_specs$Publicado <- recode(datos_specs$Publicado, "Hoy" = Sys.Date(), "Publicado hace 2 días" = Sys.Date()-1, "Publicado hace 3 días" = Sys.Date()-1)
}
{
html <- read_html(paste0("https://www.zonajobs.com.ar/ofertas-de-empleo-argentina-pagina-",pagina,".html?recientes=true"))
listado <- html_nodes(html,'div.aviso-no-sponsor')
elementos <- html_nodes(listado,'div')
#titulos <- html_text(html_nodes(elementos,'h2.titulo-aviso'))
links <- html_attr(html_node(html_nodes(elementos,'div.wrapper'),'a'),'href')
for(i in 1:length(links))
{
html <- read_html(paste0("https://www.zonajobs.com.ar",links[i]))
titulo <- limpiar_string(html_text(html_node(html,'h1.aviso_title')))
empresa <- limpiar_string(html_text(html_node(html,'span#empresa')))
specs <- html_nodes(html,'div.aviso_specs')
specs_attr <- gsub(":","",limpiar_string(html_text(html_nodes(specs,'div.spec_attr'))))
specs_def <- limpiar_string(html_text(html_nodes(specs,'div.spec_def')))
datos_specs <- as.data.frame(matrix(specs_def,nrow=1))
colnames(datos_specs) <- specs_attr
datos_specs$Publicado <- ifelse(datos_specs$Publicado == "Hoy",Sys.Date(),
Sys.Date()+1-as.numeric(gsub("[Publicado hace |días]","",datos_specs$Publicado)))
datos_specs$Publicado <- recode(datos_specs$Publicado, "Hoy" = Sys.Date(), "Publicado hace 2 días" = Sys.Date()-1, "Publicado hace 3 días" = Sys.Date()-1)
}
}
datos_specs
html <- read_html(paste0("https://www.zonajobs.com.ar",links[i]))
titulo <- limpiar_string(html_text(html_node(html,'h1.aviso_title')))
empresa <- limpiar_string(html_text(html_node(html,'span#empresa')))
specs <- html_nodes(html,'div.aviso_specs')
specs_attr <- gsub(":","",limpiar_string(html_text(html_nodes(specs,'div.spec_attr'))))
specs_def <- limpiar_string(html_text(html_nodes(specs,'div.spec_def')))
datos_specs <- as.data.frame(matrix(specs_def,nrow=1))
colnames(datos_specs) <- specs_attr
datos_specs$Publicado <- ifelse(datos_specs$Publicado == "Hoy",Sys.Date(),
Sys.Date()+1-as.numeric(gsub("[Publicado hace |días]","",datos_specs$Publicado)))
datos_specs
as.Date(datos_specs$Publicado)
html <- read_html(paste0("https://www.zonajobs.com.ar",links[i]))
titulo <- limpiar_string(html_text(html_node(html,'h1.aviso_title')))
empresa <- limpiar_string(html_text(html_node(html,'span#empresa')))
specs <- html_nodes(html,'div.aviso_specs')
specs_attr <- gsub(":","",limpiar_string(html_text(html_nodes(specs,'div.spec_attr'))))
specs_def <- limpiar_string(html_text(html_nodes(specs,'div.spec_def')))
datos_specs <- as.data.frame(matrix(specs_def,nrow=1))
colnames(datos_specs) <- specs_attr
Sys.Date()+1-as.numeric(gsub("[Publicado hace |días]","",datos_specs$Publicado))
datos_specs$Publicado
as.character(datos_specs$Publicado) == "Hoy"
datos_specs$Publicado <- ifelse(as.character(datos_specs$Publicado) == "Hoy",Sys.Date(),
Sys.Date()+1-as.numeric(gsub("[Publicado hace |días]","",datos_specs$Publicado)))
datos_specs
Sys.Date()
html <- read_html(paste0("https://www.zonajobs.com.ar",links[i]))
titulo <- limpiar_string(html_text(html_node(html,'h1.aviso_title')))
empresa <- limpiar_string(html_text(html_node(html,'span#empresa')))
specs <- html_nodes(html,'div.aviso_specs')
specs_attr <- gsub(":","",limpiar_string(html_text(html_nodes(specs,'div.spec_attr'))))
specs_def <- limpiar_string(html_text(html_nodes(specs,'div.spec_def')))
datos_specs <- as.data.frame(matrix(specs_def,nrow=1))
colnames(datos_specs) <- specs_attr
datos_specs$Fecha <- ifelse(as.character(datos_specs$Publicado) == "Hoy",Sys.Date(),
Sys.Date()+1-as.numeric(gsub("[Publicado hace |días]","",datos_specs$Publicado)))
datos_specs
datos_specs$Fecha <- if_else(as.character(datos_specs$Publicado) == "Hoy",Sys.Date(),
Sys.Date()+1-as.numeric(gsub("[Publicado hace |días]","",datos_specs$Publicado)))
datos_specs
datos_specs$Fecha <- fifelse(as.character(datos_specs$Publicado) == "Hoy",Sys.Date(),
Sys.Date()+1-as.numeric(gsub("[Publicado hace |días]","",datos_specs$Publicado)))
datos_specs$Fecha <- if_else(as.character(datos_specs$Publicado) == "Hoy",Sys.Date(),
Sys.Date()+1-as.numeric(gsub("[Publicado hace |días]","",datos_specs$Publicado)))
datos_specs
datos_specs$Publicado <- if_else(as.character(datos_specs$Publicado) == "Hoy",Sys.Date(),
Sys.Date()+1-as.numeric(gsub("[Publicado hace |días]","",datos_specs$Publicado)))
datos_specs
class(datos_specs$Publicado)
registro <- cbind(data.frame(titulo = titulo,
empresa = empresa),
datos_specs)
registro
registro <- cbind(data.frame(sitio_web = "zonajobs",
titulo = titulo,
empresa = empresa),
datos_specs)
registro
conexionDB$insert(registro)
continuar <- TRUE
pagina <- 1
while(continuar)
{
html <- read_html(paste0("https://www.zonajobs.com.ar/ofertas-de-empleo-argentina-pagina-",pagina,".html?recientes=true"))
listado <- html_nodes(html,'div.aviso-no-sponsor')
elementos <- html_nodes(listado,'div')
#titulos <- html_text(html_nodes(elementos,'h2.titulo-aviso'))
links <- html_attr(html_node(html_nodes(elementos,'div.wrapper'),'a'),'href')
for(i in 1:length(links))
{
html <- read_html(paste0("https://www.zonajobs.com.ar",links[i]))
titulo <- limpiar_string(html_text(html_node(html,'h1.aviso_title')))
empresa <- limpiar_string(html_text(html_node(html,'span#empresa')))
specs <- html_nodes(html,'div.aviso_specs')
specs_attr <- gsub(":","",limpiar_string(html_text(html_nodes(specs,'div.spec_attr'))))
specs_def <- limpiar_string(html_text(html_nodes(specs,'div.spec_def')))
datos_specs <- as.data.frame(matrix(specs_def,nrow=1))
colnames(datos_specs) <- specs_attr
datos_specs$Publicado <- if_else(as.character(datos_specs$Publicado) == "Hoy",Sys.Date(),
Sys.Date()+1-as.numeric(gsub("[Publicado hace |días]","",datos_specs$Publicado)))
registro <- cbind(data.frame(sitio_web = "zonajobs",
titulo = titulo,
empresa = empresa),
datos_specs)
conexionDB$insert(registro)
}
continuar <- FALSE
}
conexionDB$remove()
conexionDB$remove(*)
pagina <- 5
while(continuar)
{
html <- read_html(paste0("https://www.zonajobs.com.ar/ofertas-de-empleo-argentina-pagina-",pagina,".html?recientes=true"))
listado <- html_nodes(html,'div.aviso-no-sponsor')
elementos <- html_nodes(listado,'div')
#titulos <- html_text(html_nodes(elementos,'h2.titulo-aviso'))
links <- html_attr(html_node(html_nodes(elementos,'div.wrapper'),'a'),'href')
for(i in 1:length(links))
{
html <- read_html(paste0("https://www.zonajobs.com.ar",links[i]))
titulo <- limpiar_string(html_text(html_node(html,'h1.aviso_title')))
empresa <- limpiar_string(html_text(html_node(html,'span#empresa')))
specs <- html_nodes(html,'div.aviso_specs')
specs_attr <- gsub(":","",limpiar_string(html_text(html_nodes(specs,'div.spec_attr'))))
specs_def <- limpiar_string(html_text(html_nodes(specs,'div.spec_def')))
datos_specs <- as.data.frame(matrix(specs_def,nrow=1))
colnames(datos_specs) <- specs_attr
datos_specs$Publicado <- if_else(as.character(datos_specs$Publicado) == "Hoy",Sys.Date(),
Sys.Date()+1-as.numeric(gsub("[Publicado hace |días]","",datos_specs$Publicado)))
registro <- cbind(data.frame(sitio_web = "zonajobs",
titulo = titulo,
empresa = empresa),
datos_specs)
conexionDB$insert(registro)
}
continuar <- FALSE
}
pagina <- 5
continuar <- TRUE
pagina <- 5
while(continuar)
{
html <- read_html(paste0("https://www.zonajobs.com.ar/ofertas-de-empleo-argentina-pagina-",pagina,".html?recientes=true"))
listado <- html_nodes(html,'div.aviso-no-sponsor')
elementos <- html_nodes(listado,'div')
#titulos <- html_text(html_nodes(elementos,'h2.titulo-aviso'))
links <- html_attr(html_node(html_nodes(elementos,'div.wrapper'),'a'),'href')
for(i in 1:length(links))
{
html <- read_html(paste0("https://www.zonajobs.com.ar",links[i]))
titulo <- limpiar_string(html_text(html_node(html,'h1.aviso_title')))
empresa <- limpiar_string(html_text(html_node(html,'span#empresa')))
specs <- html_nodes(html,'div.aviso_specs')
specs_attr <- gsub(":","",limpiar_string(html_text(html_nodes(specs,'div.spec_attr'))))
specs_def <- limpiar_string(html_text(html_nodes(specs,'div.spec_def')))
datos_specs <- as.data.frame(matrix(specs_def,nrow=1))
colnames(datos_specs) <- specs_attr
datos_specs$Publicado <- if_else(as.character(datos_specs$Publicado) == "Hoy",Sys.Date(),
Sys.Date()+1-as.numeric(gsub("[Publicado hace |días]","",datos_specs$Publicado)))
registro <- cbind(data.frame(sitio_web = "zonajobs",
titulo = titulo,
empresa = empresa),
datos_specs)
conexionDB$insert(registro)
}
continuar <- FALSE
}
i = 1
function (x, ..., encoding = "")
html <- read_html(paste0("https://www.zonajobs.com.ar",links[i]))
html <- read_html(paste0("https://www.zonajobs.com.ar",links[i]))
titulo <- limpiar_string(html_text(html_node(html,'h1.aviso_title')))
empresa <- limpiar_string(html_text(html_node(html,'span#empresa')))
descripcion <- html_node(html,'div.aviso_descipcion')
head(descripcion)
descripcion <- html_node(html,'div.aviso_desciption')
head(descripcion)
descripcion <- html_node(html,'div.aviso_description')
head(descripcion)
descripcion <- html_text(html_node(html,'div.aviso_description'))
head(descripcion)
descripcion <- limpiar_string(html_text(html_node(html,'div.aviso_description')))
descripcion
descripcion <- gsub("[\n|\t]","",limpiar_string(html_text(html_node(html,'div.aviso_description'))))
head(descripcion)
descripcion <- gsub("[\n|\t|\n |\t ]","",limpiar_string(html_text(html_node(html,'div.aviso_description'))))
descripcion
descripcion <- gsub("[\n |\t ]","",limpiar_string(html_text(html_node(html,'div.aviso_description'))))
descripcion
descripcion <- gsub("[\n|\t]","",limpiar_string(html_text(html_node(html,'div.aviso_description'))))
descripcion
html <- read_html(paste0("https://www.zonajobs.com.ar",links[i]))
titulo <- limpiar_string(html_text(html_node(html,'h1.aviso_title')))
empresa <- limpiar_string(html_text(html_node(html,'span#empresa')))
specs <- html_nodes(html,'div.aviso_specs')
specs_attr <- gsub(":","",limpiar_string(html_text(html_nodes(specs,'div.spec_attr'))))
specs_def <- limpiar_string(html_text(html_nodes(specs,'div.spec_def')))
datos_specs <- as.data.frame(matrix(specs_def,nrow=1))
colnames(datos_specs) <- specs_attr
datos_specs$Publicado <- if_else(as.character(datos_specs$Publicado) == "Hoy",Sys.Date(),
Sys.Date()+1-as.numeric(gsub("[Publicado hace |días]","",datos_specs$Publicado)))
descripcion <- gsub("[\n|\t]","",limpiar_string(html_text(html_node(html,'div.aviso_description'))))
registro <- cbind(data.frame(sitio_web = "zonajobs",
titulo = titulo,
empresa = empresa,
descripcion = descripcion),
datos_specs)
conexionDB$insert(registro)
chequeo_si_existe <- conexionDB$find(paste0('{ "titulo" : "',titulo,'", "empresa" : "',empresa,'", "Lugar de Trabajo": "',datos_specs$`Lugar de Trabajo`,'" }'))
chequeo_si_existe
head(chequeo_si_existe[,c(1,2,3)])
i = 2
html <- read_html(paste0("https://www.zonajobs.com.ar",links[i]))
titulo <- limpiar_string(html_text(html_node(html,'h1.aviso_title')))
empresa <- limpiar_string(html_text(html_node(html,'span#empresa')))
specs <- html_nodes(html,'div.aviso_specs')
specs_attr <- gsub(":","",limpiar_string(html_text(html_nodes(specs,'div.spec_attr'))))
specs_def <- limpiar_string(html_text(html_nodes(specs,'div.spec_def')))
datos_specs <- as.data.frame(matrix(specs_def,nrow=1))
colnames(datos_specs) <- specs_attr
datos_specs$Publicado <- if_else(as.character(datos_specs$Publicado) == "Hoy",Sys.Date(),
Sys.Date()+1-as.numeric(gsub("[Publicado hace |días]","",datos_specs$Publicado)))
descripcion <- gsub("[\n|\t]","",limpiar_string(html_text(html_node(html,'div.aviso_description'))))
chequeo_si_existe <- conexionDB$find(paste0('{ "titulo" : "',titulo,'", "empresa" : "',empresa,'", "Lugar de Trabajo": "',datos_specs$`Lugar de Trabajo`,'" }'))
a <- Sys.Date()-3
a
Sys.Date()-a
as.numeric(Sys.Date()-a)
library(xml2)
library(rvest)
library(dplyr)
library(mongolite)
# Creamos la conexión a la db y collection de mongo
conexionDB <- mongo(collection = "datos", db = "scraperJobs")
# Definimos una función que limpia texto, y la voy a necesitar seguido
limpiar_string <- function(string) { return(gsub("^\\s+|\\s+$","",string)) }
# Definimos la variable 'max_dias' antes descripta
max_dias <- 14
# ~~~~~~~~ Recorrido ~~~~~~~ #
continuar <- TRUE
pagina <- 1
anuncios_procesados <- 0
while(continuar)
{
html <- read_html(paste0("https://www.zonajobs.com.ar/ofertas-de-empleo-argentina-pagina-",pagina,".html?recientes=true"))
listado <- html_nodes(html,'div.aviso-no-sponsor')
elementos <- html_nodes(listado,'div')
links <- html_attr(html_node(html_nodes(elementos,'div.wrapper'),'a'),'href')
i <- 1
while(i <= length(links) & continuar)
{
html <- read_html(paste0("https://www.zonajobs.com.ar",links[i]))
titulo <- limpiar_string(html_text(html_node(html,'h1.aviso_title')))
empresa <- limpiar_string(html_text(html_node(html,'span#empresa')))
specs <- html_nodes(html,'div.aviso_specs')
specs_attr <- gsub(":","",limpiar_string(html_text(html_nodes(specs,'div.spec_attr'))))
specs_def <- limpiar_string(html_text(html_nodes(specs,'div.spec_def')))
datos_specs <- as.data.frame(matrix(specs_def,nrow=1))
colnames(datos_specs) <- specs_attr
datos_specs$Publicado <- if_else(as.character(datos_specs$Publicado) == "Hoy",Sys.Date(),
Sys.Date()+1-as.numeric(gsub("[Publicado hace |días]","",datos_specs$Publicado)))
descripcion <- gsub("[\n|\t]","",limpiar_string(html_text(html_node(html,'div.aviso_description'))))
chequeo_si_existe <- conexionDB$find(paste0('{ "titulo" : "',titulo,'", "empresa" : "',empresa,'", "Lugar de Trabajo": "',datos_specs$`Lugar de Trabajo`,'" }'))
if(nrow(chequeo_si_existe) == 0 & as.numeric(Sys.Date()-datos_specs$Publicado) <= max_dias)
{
registro <- cbind(data.frame(sitio_web = "zonajobs",
titulo = titulo,
empresa = empresa,
descripcion = descripcion),
datos_specs)
conexionDB$insert(registro)
}
else
{
continuar = FALSE
}
i <- i + 1
anuncios_procesados <- anuncios_procesados + 1
cat(anuncios_procesados," anuncios procesados en un total de ",pagina," páginas\r")
}
pagina <- pagina + 1
}
print(ifelse(nrow(chequeo_si_existe)>0,"Se detuvo porque encontró otro registro igual en la base de datos","Se detuvo porque alcanzó 'max_dias'"))
chequeo_si_existe
library(xml2)
library(rvest)
library(dplyr)
library(mongolite)
# Creamos la conexión a la db y collection de mongo
conexionDB <- mongo(collection = "datos", db = "scraperJobs")
# Definimos una función que limpia texto, y la voy a necesitar seguido
limpiar_string <- function(string) { return(gsub("^\\s+|\\s+$","",string)) }
# Definimos la variable 'max_dias' antes descripta
max_dias <- 14
# ~~~~~~~~ Recorrido ~~~~~~~ #
continuar <- TRUE
pagina <- 1
anuncios_procesados <- 0
while(continuar)
{
html <- read_html(paste0("https://www.zonajobs.com.ar/ofertas-de-empleo-argentina-pagina-",pagina,".html?recientes=true"))
listado <- html_nodes(html,'div.aviso-no-sponsor')
elementos <- html_nodes(listado,'div')
links <- html_attr(html_node(html_nodes(elementos,'div.wrapper'),'a'),'href')
i <- 1
while(i <= length(links) & continuar)
{
html <- read_html(paste0("https://www.zonajobs.com.ar",links[i]))
titulo <- limpiar_string(html_text(html_node(html,'h1.aviso_title')))
empresa <- limpiar_string(html_text(html_node(html,'span#empresa')))
specs <- html_nodes(html,'div.aviso_specs')
specs_attr <- gsub(":","",limpiar_string(html_text(html_nodes(specs,'div.spec_attr'))))
specs_def <- limpiar_string(html_text(html_nodes(specs,'div.spec_def')))
datos_specs <- as.data.frame(matrix(specs_def,nrow=1))
colnames(datos_specs) <- specs_attr
datos_specs$Publicado <- if_else(as.character(datos_specs$Publicado) == "Hoy",Sys.Date(),
Sys.Date()+1-as.numeric(gsub("[Publicado hace |días]","",datos_specs$Publicado)))
descripcion <- gsub("[\n|\t]","",limpiar_string(html_text(html_node(html,'div.aviso_description'))))
chequeo_si_existe <- conexionDB$find(paste0('{ "titulo" : "',titulo,'", "empresa" : "',empresa,'", "Lugar de Trabajo": "',datos_specs$`Lugar de Trabajo`,'", "descripcion": "',descripcion,'" }'))
if(nrow(chequeo_si_existe) == 0 & as.numeric(Sys.Date()-datos_specs$Publicado) <= max_dias)
{
registro <- cbind(data.frame(sitio_web = "zonajobs",
titulo = titulo,
empresa = empresa,
descripcion = descripcion),
datos_specs)
conexionDB$insert(registro)
}
else
{
print(ifelse(nrow(chequeo_si_existe)>0,"Se detuvo porque encontró otro registro igual en la base de datos","Se detuvo porque alcanzó 'max_dias'"))
continuar = FALSE
}
i <- i + 1
anuncios_procesados <- anuncios_procesados + 1
cat(anuncios_procesados," anuncios procesados en un total de ",pagina," páginas\r")
}
pagina <- pagina + 1
}
library(xml2)
library(rvest)
library(dplyr)
library(mongolite)
# Creamos la conexión a la db y collection de mongo
conexionDB <- mongo(collection = "datos", db = "scraperJobs")
# Definimos una función que limpia texto, y la voy a necesitar seguido
limpiar_string <- function(string) { return(gsub("^\\s+|\\s+$","",string)) }
# Definimos la variable 'max_dias' antes descripta
max_dias <- 14
# ~~~~~~~~ Recorrido ~~~~~~~ #
continuar <- TRUE
pagina <- 1
anuncios_procesados <- 0
while(continuar)
{
html <- read_html(paste0("https://www.zonajobs.com.ar/ofertas-de-empleo-argentina-pagina-",pagina,".html?recientes=true"))
listado <- html_nodes(html,'div.aviso-no-sponsor')
elementos <- html_nodes(listado,'div')
links <- html_attr(html_node(html_nodes(elementos,'div.wrapper'),'a'),'href')
i <- 1
while(i <= length(links) & continuar)
{
html <- read_html(paste0("https://www.zonajobs.com.ar",links[i]))
titulo <- limpiar_string(html_text(html_node(html,'h1.aviso_title')))
empresa <- limpiar_string(html_text(html_node(html,'span#empresa')))
specs <- html_nodes(html,'div.aviso_specs')
specs_attr <- gsub(":","",limpiar_string(html_text(html_nodes(specs,'div.spec_attr'))))
specs_def <- limpiar_string(html_text(html_nodes(specs,'div.spec_def')))
datos_specs <- as.data.frame(matrix(specs_def,nrow=1))
colnames(datos_specs) <- specs_attr
datos_specs$Publicado <- if_else(as.character(datos_specs$Publicado) == "Hoy",Sys.Date(),
Sys.Date()+1-as.numeric(gsub("[Publicado hace |días]","",datos_specs$Publicado)))
descripcion <- gsub("[\n|\t]","",limpiar_string(html_text(html_node(html,'div.aviso_description'))))
chequeo_si_existe <- conexionDB$find(paste0('{ "titulo" : "',titulo,'", "empresa" : "',empresa,'", "Lugar de Trabajo": "',datos_specs$`Lugar de Trabajo`,'" }'))
if(nrow(chequeo_si_existe) == 0 & as.numeric(Sys.Date()-datos_specs$Publicado) <= max_dias)
{
registro <- cbind(data.frame(sitio_web = "zonajobs",
titulo = titulo,
empresa = empresa,
descripcion = descripcion),
datos_specs)
conexionDB$insert(registro)
}
else if(as.numeric(Sys.Date()-datos_specs$Publicado) > max_dias)
{
print(ifelse(nrow(chequeo_si_existe)>0,"Se detuvo porque encontró otro registro igual en la base de datos","Se detuvo porque alcanzó 'max_dias'"))
continuar = FALSE
}
i <- i + 1
anuncios_procesados <- anuncios_procesados + 1
cat(anuncios_procesados," anuncios procesados en un total de ",pagina," páginas\r")
}
pagina <- pagina + 1
}
conexionDB$disconnect()
